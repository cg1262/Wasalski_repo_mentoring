{% extends "base.html" %}

{% block title %}Panel główny - Finance Tracker Excel{% endblock %}

{% block content %}
<!-- Control Panel Section - Like Excel's input area -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="control-panel">
            <h5><i class="fas fa-calculator"></i> Panel kontrolny</h5>
            {% if control_panel %}
            <div class="row">
                <div class="col-6 mb-2">
                    <label class="form-label">Przychód miesięczny netto:</label>
                    <div class="excel-number excel-currency">{{ "%.2f"|format(control_panel.monthly_income_net) }}</div>
                </div>
                <div class="col-6 mb-2">
                    <label class="form-label">Liczba godzin tygodnia:</label>
                    <div class="excel-number">{{ control_panel.monthly_hours }}</div>
                </div>
                <div class="col-6 mb-2">
                    <label class="form-label">Stawka:</label>
                    <div class="excel-number excel-currency">{{ "%.2f"|format(control_panel.hourly_rate) }}</div>
                </div>
                <div class="col-6 mb-2">
                    <label class="form-label">VAT:</label>
                    <div class="excel-number">{{ control_panel.vat_rate }}%</div>
                </div>
                <div class="col-6 mb-2">
                    <label class="form-label">Koszt wynajmu:</label>
                    <div class="excel-number excel-currency">{{ "%.2f"|format(control_panel.rent_cost) }}</div>
                </div>
                <div class="col-6 mb-2">
                    <label class="form-label">Przychód brutto:</label>
                    <div class="excel-number excel-currency">{{ "%.2f"|format(przychod_brutto) }}</div>
                </div>
            </div>
            <div class="mt-3">
                <a href="{{ url_for('control_panel') }}" class="btn btn-light btn-sm">
                    <i class="fas fa-edit"></i> Edytuj
                </a>
            </div>
            {% else %}
            <p>Brak danych w panelu kontrolnym.</p>
            <a href="{{ url_for('control_panel') }}" class="btn btn-light">
                <i class="fas fa-plus"></i> Skonfiguruj panel
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Summary Calculations - Excel-like -->
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="excel-summary-box excel-summary-positive">
                    <h6>Przychód z VAT</h6>
                    <h4 class="excel-number excel-currency">{{ "%.2f"|format(przychod_z_vat) }}</h4>
                    <small>VAT: {{ "%.2f"|format(vat_amount) }} zł</small>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="excel-summary-box excel-summary-negative">
                    <h6>Wydatek na rękę</h6>
                    <h4 class="excel-number excel-currency">{{ "%.2f"|format(wydatek_na_reke) }}</h4>
                    <small>Suma wydatków + leasing</small>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="excel-summary-box excel-summary-neutral">
                    <h6>Leasing miesięczny</h6>
                    <h4 class="excel-number excel-currency">{{ "%.2f"|format(total_leasing) }}</h4>
                    <small>{{ active_leasing|length }} aktywnych</small>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="excel-summary-box {% if zostaje >= 0 %}excel-summary-positive{% else %}excel-summary-negative{% endif %}">
                    <h6>Kominek miesięczny</h6>
                    <h4 class="excel-number excel-currency">{{ "%.2f"|format(zostaje) }}</h4>
                    <small>Zostaje na następny miesiąc</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Monthly Expenses Breakdown - Excel-like categories -->
<div class="row mb-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-pie"></i> Wydatki bieżącego miesiąca - kategorie</h5>
            </div>
            <div class="card-body">
                {% if monthly_expenses %}
                <table class="table excel-table table-sm">
                    <thead>
                        <tr>
                            <th>Kategoria</th>
                            <th>Liczba</th>
                            <th>Kwota</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for expense in monthly_expenses %}
                        <tr class="category-{{ expense.category.lower().replace('ń', 'n').replace('ś', 's').replace('ć', 'c').replace('ł', 'l').replace('ą', 'a').replace('ę', 'e').replace('ź', 'z').replace('ż', 'z') }}">
                            <td><strong>{{ expense.category }}</strong></td>
                            <td class="text-center">{{ expense.count }}</td>
                            <td class="excel-number">{{ "%.2f"|format(expense.total_amount) }} zł</td>
                            <td class="excel-number">
                                {% if total_monthly_expenses > 0 %}
                                    {{ "%.1f"|format((expense.total_amount / total_monthly_expenses) * 100) }}%
                                {% else %}
                                    0.0%
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        <tr style="background-color: var(--excel-gray); font-weight: bold;">
                            <td><strong>SUMA</strong></td>
                            <td class="text-center">{{ monthly_expenses|sum(attribute='count') }}</td>
                            <td class="excel-number">{{ "%.2f"|format(total_monthly_expenses) }} zł</td>
                            <td class="excel-number">100.0%</td>
                        </tr>
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Brak wydatków w bieżącym miesiącu</p>
                    <a href="{{ url_for('month_detail', year=current_year, month=current_month) }}" class="btn btn-excel-primary">
                        <i class="fas fa-plus"></i> Dodaj pierwszy wydatek
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Active Leasing -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-credit-card"></i> Aktywny leasing</h5>
            </div>
            <div class="card-body">
                {% if active_leasing %}
                <table class="table excel-table table-sm">
                    <thead>
                        <tr>
                            <th>Opis</th>
                            <th>Kwota</th>
                            <th>Pozostało</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lease in active_leasing %}
                        <tr class="category-leasing">
                            <td>{{ lease.description }}</td>
                            <td class="excel-number">{{ "%.2f"|format(lease.monthly_amount) }} zł</td>
                            <td class="text-center">{{ lease.total_months - lease.months_paid }}/{{ lease.total_months }}</td>
                        </tr>
                        {% endfor %}
                        <tr style="background-color: var(--excel-gray); font-weight: bold;">
                            <td><strong>SUMA</strong></td>
                            <td class="excel-number">{{ "%.2f"|format(total_leasing) }} zł</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-3">
                    <i class="fas fa-credit-card fa-2x text-muted mb-2"></i>
                    <p class="text-muted">Brak aktywnego leasingu</p>
                </div>
                {% endif %}
                <div class="text-center mt-3">
                    <a href="{{ url_for('leasing') }}" class="btn btn-excel-secondary btn-sm">
                        <i class="fas fa-list"></i> Zarządzaj leasingiem
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Upcoming Planned Expenses -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-calendar-check"></i> Nadchodzące planowane wydatki</h5>
            </div>
            <div class="card-body">
                {% if upcoming_planned %}
                <table class="table excel-table table-sm">
                    <thead>
                        <tr>
                            <th>Opis</th>
                            <th>Kwota</th>
                            <th>Data planowana</th>
                            <th>Kategoria</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set month_names = ['', 'Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'] %}
                        {% for planned in upcoming_planned %}
                        <tr>
                            <td>{{ planned.description }}</td>
                            <td class="excel-number">{{ "%.2f"|format(planned.amount) }} zł</td>
                            <td>{{ month_names[planned.planned_month] }} {{ planned.planned_year }}</td>
                            <td><span class="badge bg-primary">{{ planned.category }}</span></td>
                            <td>
                                <span class="status-indicator status-warning"></span>
                                Oczekuje
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-3">
                    <i class="fas fa-calendar-check fa-2x text-muted mb-2"></i>
                    <p class="text-muted">Brak planowanych wydatków</p>
                </div>
                {% endif %}
                <div class="text-center mt-3">
                    <a href="{{ url_for('yearly_planned') }}" class="btn btn-excel-secondary btn-sm">
                        <i class="fas fa-plus"></i> Zarządzaj planowanymi wydatkami
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-bolt"></i> Szybkie akcje</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('month_detail', year=current_year, month=current_month) }}" 
                           class="btn btn-excel-primary w-100">
                            <i class="fas fa-calendar-day"></i><br>
                            Bieżący miesiąc
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('control_panel') }}" class="btn btn-excel-secondary w-100">
                            <i class="fas fa-cog"></i><br>
                            Panel kontrolny
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('leasing') }}" class="btn btn-excel-secondary w-100">
                            <i class="fas fa-credit-card"></i><br>
                            Leasing
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('savings') }}" class="btn btn-excel-secondary w-100">
                            <i class="fas fa-piggy-bank"></i><br>
                            Oszczędności
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Excel-like functionality
    $(document).ready(function() {
        // Highlight rows on hover
        $('.excel-table tbody tr').hover(
            function() { $(this).css('background-color', '#f8f9fa'); },
            function() { $(this).css('background-color', ''); }
        );

        // Auto-refresh every 30 seconds for real-time feel
        setTimeout(function() {
            location.reload();
        }, 30000);
    });
</script>
{% endblock %}